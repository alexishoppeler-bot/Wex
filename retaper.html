<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>R√©-taper le texte</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f172a;
  --card:#020617;
  --border:#1e293b;
  --brand:#14b8a6;
  --brand-soft:rgba(20,184,166,.15);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --error:#ef4444;
  --success:#22c55e;
  --radius:14px;
}

*{box-sizing:border-box}

html,body{
  height:100%;
  margin:0;
  overflow:hidden;
}

body{
  font-family:"Open Sans", Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

.app{
  height:100vh;
  display:flex;
  justify-content:center;
  padding:14px;
}

.container{
  width:100%;
  max-width:800px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* cartes */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:12px 14px;
}

.title{
  color:var(--brand);
  font-weight:700;
  font-size:14px;
  margin-bottom:6px;
}

.consigne{
  font-size:14px;
  color:var(--muted);
  line-height:1.45;
}

.consigne strong{ color:var(--text); }

/* ===== PROGRESSION ===== */
.progress-card{
  padding:10px 14px;
}

.progress-top{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  color:var(--muted);
  margin-bottom:6px;
}

.progress-bar{
  width:100%;
  height:10px;
  background:#020617;
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
}

.progress-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--brand),#22c55e);
  transition:width .3s ease;
}

/* phrase */
.phrase{
  font-size:17px;
  line-height:1.45;
  background:var(--brand-soft);
  padding:12px;
  border-left:4px solid var(--brand);
  border-radius:10px;
  word-break:break-word;
}

/* zone centrale */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:12px;
  min-height:0;
}

/* textarea */
textarea{
  flex:1;
  width:100%;
  resize:none;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
  outline:none;
  font-size:16px;
  line-height:1.45;
}

textarea:focus{ border-color:var(--brand); }

/* aper√ßu */
.preview{
  border:1px dashed var(--border);
  border-radius:12px;
  background:#020617;
  padding:12px;
  min-height:48px;
  font-size:15px;
  line-height:1.45;
  word-break:break-word;
}

@keyframes blink{
  0%{opacity:1}
  50%{opacity:.35}
  100%{opacity:1}
}

.badChar{
  color:var(--error);
  font-weight:800;
  animation:blink 1s ease-in-out infinite;
}

/* fin */
.end{
  text-align:center;
  font-weight:800;
  font-size:22px;
  color:var(--success);
}

.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:var(--brand);
  color:#022c22;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">
  <div class="container">

    <!-- PROGRESSION -->
    <div class="card progress-card" id="progressCard">
      <div class="progress-top">
        <span>Progression</span>
        <span id="progressText">0 / 0</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <!-- CONSIGNE -->
    <div class="card" id="consigneCard">
      <div class="title">Consigne</div>
      <div class="consigne">
        Retapez la phrase <strong>exactement</strong>.<br>
        Quand vous avez termin√©, appuyez sur <strong>Entr√©e</strong>.
      </div>
    </div>

    <!-- PHRASE -->
    <div class="card" id="phraseCard">
      <div class="title">Phrase √† retaper</div>
      <div class="phrase" id="phrase"></div>
    </div>

    <!-- ZONE DE TRAVAIL -->
    <div class="main" id="workZone">
      <div class="card" style="flex:1;display:flex;flex-direction:column;gap:12px;">
        <div class="title">Votre r√©ponse</div>
        <textarea id="input" spellcheck="false" autocomplete="off"></textarea>

        <div>
          <div class="title" style="margin:0 0 6px 0;">Aper√ßu apr√®s validation</div>
          <div class="preview" id="preview"></div>
        </div>
      </div>
    </div>

    <!-- FIN -->
    <div class="card" id="endCard" style="display:none;">
      <div class="end">üéâ Bravo, exercice termin√©</div>
      <button class="btn" id="resetBtn">Recommencer</button>
    </div>

  </div>
</div>

<script>
/* =====================
   DONN√âES
===================== */
const phrases = [
  // ===== A1 ‚Äì tr√®s simple (1‚Äì20) =====
  "Je travaille.",
  "Je suis ponctuel.",
  "Je respecte les consignes.",
  "Je respecte les horaires.",
  "Je travaille en √©quipe.",
  "Je pr√©pare le mat√©riel.",
  "Je commence √† l‚Äôheure.",
  "Je termine mon travail.",
  "Je travaille avec s√©rieux.",
  "Je fais attention.",
  "Je respecte la s√©curit√©.",
  "Je porte l‚Äô√©quipement.",
  "Je nettoie mon poste.",
  "Je range le mat√©riel.",
  "Je laisse le poste propre.",
  "Je demande de l‚Äôaide.",
  "Je pose des questions.",
  "Je parle avec le responsable.",
  "Je respecte mes coll√®gues.",
  "Je prends une pause.",

  // ===== A1+ / A2 ‚Äì simple mais complet (21‚Äì40) =====
  "Je travaille calmement et correctement.",
  "Je respecte les r√®gles de l‚Äôentreprise.",
  "Je fais les t√¢ches demand√©es.",
  "Je reviens √† l‚Äôheure apr√®s la pause.",
  "Je continue mon travail apr√®s la pause.",
  "Je m‚Äôorganise pour la journ√©e.",
  "Je respecte les priorit√©s.",
  "Je termine les t√¢ches pr√©vues.",
  "Je v√©rifie mon travail.",
  "Je corrige mes erreurs.",
  "Je fais attention √† la s√©curit√© au travail.",
  "Je nettoie le mat√©riel apr√®s le travail.",
  "Je respecte le planning.",
  "Je note mes heures de travail.",
  "Je suis pr√©sent et attentif.",
  "Je pr√©viens en cas d‚Äôabsence.",
  "Je travaille le matin.",
  "Je travaille l‚Äôapr√®s-midi.",
  "Je respecte le temps de pause.",
  "Je fais mon travail avec soin.",

  // ===== A2 ‚Äì phrases plus structur√©es (41‚Äì70) =====
  "Je travaille de mani√®re organis√©e.",
  "Je respecte les consignes donn√©es par mon responsable.",
  "Je pr√©pare le mat√©riel avant de commencer.",
  "Je fais mon travail avec attention et s√©rieux.",
  "Je termine les t√¢ches dans le temps pr√©vu.",
  "Je v√©rifie mon travail avant de finir.",
  "Je signale un probl√®me quand il y en a un.",
  "Je communique avec mon responsable si n√©cessaire.",
  "Je respecte les r√®gles de s√©curit√© de l‚Äôentreprise.",
  "Je travaille efficacement tout au long de la journ√©e.",
  "Je fais attention au mat√©riel mis √† disposition.",
  "Je range mon poste de travail apr√®s chaque t√¢che.",
  "Je m‚Äôorganise pour √©viter les erreurs.",
  "Je respecte mes coll√®gues et le travail d‚Äô√©quipe.",
  "Je fais les t√¢ches demand√©es avec s√©rieux.",
  "Je respecte les horaires fix√©s par l‚Äôentreprise.",
  "Je travaille avec concentration et calme.",
  "Je prends mes responsabilit√©s au travail.",
  "Je respecte les priorit√©s de la journ√©e.",
  "Je contribue √† une bonne ambiance de travail.",
  "Je fais mon travail de mani√®re r√©guli√®re.",
  "Je m‚Äôadapte aux consignes du poste.",
  "Je respecte les proc√©dures de travail.",
  "Je demande de l‚Äôaide en cas de difficult√©.",
  "Je travaille de fa√ßon autonome quand c‚Äôest possible.",
  "Je veille √† la qualit√© de mon travail.",
  "Je fais attention aux d√©tails importants.",
  "Je respecte les d√©lais demand√©s.",
  "Je m‚Äôint√®gre bien dans l‚Äô√©quipe.",
  "Je participe activement au travail.",

  // ===== B1 ‚Äì plus long, professionnel (71‚Äì100) =====
  "Je travaille de mani√®re organis√©e afin d‚Äô√©viter les erreurs.",
  "Je respecte les consignes et les horaires fix√©s par l‚Äôentreprise.",
  "Je pr√©pare le mat√©riel n√©cessaire avant de commencer mon travail.",
  "Je r√©alise les t√¢ches confi√©es avec soin et r√©gularit√©.",
  "Je v√©rifie syst√©matiquement mon travail avant de le terminer.",
  "Je signale rapidement tout probl√®me √† mon responsable.",
  "Je respecte strictement les r√®gles de s√©curit√© au travail.",
  "Je m‚Äôorganise efficacement pour respecter les priorit√©s.",
  "Je travaille en √©quipe tout en restant autonome.",
  "Je fais preuve de s√©rieux et de fiabilit√© au quotidien.",
  "Je m‚Äôadapte aux exigences du poste et aux consignes donn√©es.",
  "Je respecte le mat√©riel et les outils mis √† disposition.",
  "Je veille √† maintenir mon poste de travail propre et rang√©.",
  "Je communique clairement avec mes coll√®gues et mon responsable.",
  "Je prends des initiatives adapt√©es √† mon poste de travail.",
  "Je travaille avec concentration pour garantir un travail de qualit√©.",
  "Je respecte les d√©lais tout en maintenant un bon niveau de qualit√©.",
  "Je contribue activement √† une ambiance de travail positive.",
  "Je fais attention √† la s√©curit√© de mes coll√®gues et de moi-m√™me.",
  "Je m‚Äôengage √† effectuer mon travail avec s√©rieux et professionnalisme."
];



const APOST = new Set(["'", "‚Äô", "‚Äò", "`", "¬¥"]);

/* =====================
   CL√âS LOCALSTORAGE
===================== */
const STORE_INDEX = "rt_index";
const STORE_INPUT_PREFIX = "rt_input_";

/* =====================
   √âTAT
===================== */
let index = Number(localStorage.getItem(STORE_INDEX)) || 0;
let hasValidated = false;

/* =====================
   DOM
===================== */
const phraseEl = document.getElementById("phrase");
const input = document.getElementById("input");
const preview = document.getElementById("preview");
const endCard = document.getElementById("endCard");
const resetBtn = document.getElementById("resetBtn");

const consigneCard = document.getElementById("consigneCard");
const phraseCard = document.getElementById("phraseCard");
const workZone = document.getElementById("workZone");

const progressCard = document.getElementById("progressCard");
const progressText = document.getElementById("progressText");
const progressFill = document.getElementById("progressFill");

/* =====================
   UTILS
===================== */
function eqChar(a,b){
  if(a===b) return true;
  if(APOST.has(a) && APOST.has(b)) return true;
  return false;
}

function firstMismatch(expected, typed){
  const max = Math.max(expected.length, typed.length);
  for(let i=0;i<max;i++){
    const e = expected[i];
    const t = typed[i];
    if(e===undefined || t===undefined) return i;
    if(!eqChar(e,t)) return i;
  }
  return null;
}

function escapeHtml(s){
  return (s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =====================
   PROGRESSION
===================== */
function updateProgress(){
  const total = phrases.length;
  const current = Math.min(index, total);
  progressText.textContent = `${current} / ${total}`;
  progressFill.style.width = (current / total * 100) + "%";
}

/* =====================
   RENDER
===================== */
function render(){
  const expected = phrases[index];
  const value = input.value || "";

  if(!value){
    preview.textContent = "";
    return;
  }

  if(!hasValidated){
    preview.textContent = value;
    return;
  }

  const m = firstMismatch(expected, value);

  if(m === null){
    preview.textContent = value;
    return;
  }

  const before = value.slice(0,m);
  const ch = value[m] ?? "‚ñØ";
  const after = value.slice(m+1);

  preview.innerHTML =
    escapeHtml(before) +
    `<span class="badChar">${escapeHtml(ch)}</span>` +
    escapeHtml(after);
}

/* =====================
   NAVIGATION
===================== */
function finish(){
  progressCard.style.display = "none";
  consigneCard.style.display = "none";
  phraseCard.style.display = "none";
  workZone.style.display = "none";
  endCard.style.display = "block";
  input.blur();
}

function load(){
  updateProgress();

  if(index >= phrases.length){
    finish();
    return;
  }

  endCard.style.display = "none";
  progressCard.style.display = "block";
  consigneCard.style.display = "block";
  phraseCard.style.display = "block";
  workZone.style.display = "flex";

  phraseEl.textContent = phrases[index];
  input.value = localStorage.getItem(STORE_INPUT_PREFIX + index) || "";
  preview.textContent = input.value;
  hasValidated = false;
  input.focus();
}

/* =====================
   EVENTS
===================== */
input.addEventListener("input", () => {
  hasValidated = false;
  preview.textContent = input.value;
  localStorage.setItem(STORE_INPUT_PREFIX + index, input.value);
});

input.addEventListener("keydown", (e) => {
  if(e.key !== "Enter") return;
  e.preventDefault();

  hasValidated = true;

  const expected = phrases[index];
  const value = input.value || "";

  if(value.length < expected.length){
    render();
    return;
  }

  if(firstMismatch(expected, value) === null){
    index++;
    localStorage.setItem(STORE_INDEX, index);
    load();
  }else{
    render();
  }
});

resetBtn.addEventListener("click", () => {
  localStorage.removeItem(STORE_INDEX);
  for(let i=0;i<phrases.length;i++){
    localStorage.removeItem(STORE_INPUT_PREFIX + i);
  }
  index = 0;
  load();
});

/* =====================
   INIT
===================== */
load();
</script>

</body>
</html>

